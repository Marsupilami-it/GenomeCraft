# ML System Design Document for GenomeCraft

P.S. проект под NDA - поэтому без явных деталей реализации.

**GenomeCraft** — это MLOps платформа полного цикла развертывания для генных инженеров, биологов и других специалистов в области генной инженерии. Основные причины разработки:

- **Автоматизация процессов**: Снижение времени и усилий на обработку и анализ генных данных.
- **Повышение качества анализа**: Использование современных методов машинного обучения и статистического анализа.
- **Коллаборация**: Возможность совместной работы нескольких научных лабораторий.
- **Удобство использования**: Интуитивно понятный интерфейс для пользователей различных уровней технической подготовки.

## Бизнес-требования и ограничения

### Бизнес-требования

- **Удобство загрузки и обработки данных**: Пользователи должны легко загружать и обрабатывать свои данные.
- **Автоматизация преобразований**: Автоматическое распознавание форматов данных, удаление выбросов, категоризация колонок.
- **Визуализация данных**: Создание информативных графиков и диаграмм для анализа данных.
- **Модели машинного обучения**: Возможность загрузки собственных моделей или использования моделей платформы.
- **Сохранение результатов**: Сохранение результатов экспериментов в виде дашбордов.
- **Фича-стор**: Управление и выбор преобразований данных.
- **Совместная работа**: Возможность совместного проведения экспериментов несколькими лабораториями.

### Ограничения

- **Компьютерные ресурсы**: Ограничение по вычислительным ресурсам для обработки больших объемов данных.
- **Безопасность данных**: Строгие требования к защите конфиденциальных данных.
- **Техническая сложность**: Необходимость работы с современными технологиями машинного обучения и обработки данных.
- **Командные ресурсы**: Ограниченные ресурсы команды разработчиков и специалистов в области биоинформатики.

### Бизнес-цель

**Цель:** Создание MLOps платформы для автоматизации процесса анализа генных данных, обработки и моделирования, а также предоставления инструментов для совместной работы нескольких научных лабораторий.

### Импакт от создаваемого решения

- **Автоматизация:** Уменьшение времени и усилий на обработку и анализ генных данных.
- **Повышение качества анализа:** Использование современных методов машинного обучения и статистического анализа.
- **Коллаборация:** Возможность совместной работы нескольких научных лабораторий.
- **Удобство использования:** Интуитивно понятный интерфейс для пользователей различных уровней технической подготовки.

### Что будем считать успехом итерации с точки зрения бизнеса

- **Успешная загрузка и обработка данных:** Пользователи могут легко загружать и нормализовывать генетические данные.
- **Актуальные результаты анализа:** Пользователи получают точные и информативные результаты анализа.
- **Пользовательский опыт:** Использование платформы является удобным и интуитивно понятным.
- **Совместная работа:** Возможность совместной работы нескольких лабораторий без проблем.

## Что входит в скоуп проекта/итерации, что не входит

### Что мы ожидаем от конкретной итерации 

- **Итерация 1:**
  - Реализация загрузки и автоматической обработки данных.
  - Визуализация данных с использованием графиков и диаграмм.
  - Интеграция базовых моделей машинного обучения.
  - Создание личного кабинета пользователя.

- **Итерация 2:**
  - Расширение функционала моделей машинного обучения.
  - Управление преобразованиями данных (фича-стор).
  - Совместная работа нескольких научных лабораторий.

#### Что не будет закрыто Data Scientist

- **Итерация 1:**
  - Интеграция дополнительных моделей машинного обучения.
  - Совместная работа нескольких научных лабораторий.

- **Итерация 2:**
  - Интеграция с внешними сервисами и API.
  - Разработка мобильного приложения для доступа к платформе.

### Входит в скоуп

- **Разработка бэкенда**: Создание серверной части с использованием Python, FastAPI, PostgreSQL.
- **Разработка фронтенда**: Создание пользовательского интерфейса с использованием React, TypeScript.
- **Обработка данных**: Реализация автоматических преобразований данных с использованием Pandas, NumPy.
- **Визуализация данных**: Создание графиков и диаграмм с использованием Plotly, Matplotlib, D3.js.
- **Модели машинного обучения**: Интеграция моделей Scikit-learn, TensorFlow, PyTorch.
- **Фича-стор**: Разработка системы управления преобразованиями данных.
- **Система контроля версий**: Использование Git для управления кодом.
- **Контейнеризация**: Деплой приложения с использованием Docker, Kubernetes.
- **CI/CD**: Настройка автоматического тестирования и развертывания с использованием GitHub Actions, GitLab CI.

### Не входит в скоуп

- **Интеграция с внешними сервисами**: Внешние API для дополнительных функций (например, внешние базы данных генетических данных).
- **Дополнительные модули машинного обучения**: Разработка новых моделей машинного обучения за пределами существующих интеграций.
- **Дополнительные инструменты визуализации**: Внедрение дополнительных библиотек для визуализации данных.
- **Мобильное приложение**: Разработка мобильного интерфейса для доступа к платформе.

## Предпосылки решения

### Технологический стек

- **Backend**: Python, FastAPI, PostgreSQL
- **Frontend**: React, TypeScript, Material-UI
- **Машинное обучение**: Scikit-learn, TensorFlow, PyTorch
- **Обработка данных**: Pandas, NumPy
- **Визуализация**: Plotly, Matplotlib, D3.js
- **Контейнеризация**: Docker, Kubernetes
- **CI/CD**: GitHub Actions, GitLab CI

### Архитектурные решения

- **Микросервисная архитектура**: Разделение приложения на независимые сервисы для лучшей масштабируемости и поддерживаемости.
- **REST API**: Использование RESTful API для взаимодействия между клиентом и сервером.
- **База данных**: PostgreSQL для хранения метаданных и результатов экспериментов.
- **Контейнеризация**: Docker для создания изолированных сред для каждого сервиса.
- **Оркестрация**: Kubernetes для управления контейнерами и обеспечения высокой доступности.

### Безопасность данных

- **Шифрование данных**: Шифрование данных в передаче и хранении.
- **Разграничение доступа**: Использование ролевых систем для управления доступом пользователей.
- **Аудит**: Логирование всех операций для мониторинга и аудита.

## Постановка задачи

Цель проекта **GenomeCraft** — создать платформу, которая автоматизирует процесс анализа генных данных и предоставляет инструменты для моделирования и визуализации результатов. Конкретные задачи:

1. **Разработка бэкенда**:
    - Создание REST API для взаимодействия с фронтендом.
    - Реализация модуля обработки данных с автоматическим распознаванием форматов, удалением выбросов, категоризацией колонок.
    - Интеграция моделей машинного обучения для анализа данных.
    - Разработка системы хранения метаданных и результатов экспериментов.

2. **Разработка фронтенда**:
    - Создание пользовательского интерфейса для загрузки и обработки данных.
    - Реализация визуализации данных с использованием графиков и диаграмм.
    - Разработка системы управления моделями машинного обучения.
    - Создание дашбордов для сохранения и анализа результатов экспериментов.

3. **Обработка данных**:
    - Реализация автоматических преобразований данных с использованием библиотек Pandas и NumPy.
    - Разработка системы управления преобразованиями данных (фича-стор).

4. **Модели машинного обучения**:
    - Интеграция существующих моделей Scikit-learn, TensorFlow, PyTorch.
    - Разработка системы для загрузки и использования собственных моделей пользователей.

5. **Визуализация данных**:
    - Создание информативных графиков и диаграмм с использованием Plotly, Matplotlib и D3.js.

6. **Система контроля версий**:
    - Настройка Git для управления кодом и совместной работы команды разработчиков.

7. **Контейнеризация**:
    - Создание Docker-контейнеров для каждого сервиса.
    - Настройка Kubernetes для оркестрации контейнеров.

8. **CI/CD**:
    - Настройка автоматических тестов для бэкенда и фронтенда.
    - Настройка автоматического развертывания приложения с использованием GitHub Actions или GitLab CI.

## Блок-схема решения

1. **Пользователь**:
    - Загружает генетические данные на платформу.
    - Выполняет обработку данных через интерфейс.
    - Запускает модели машинного обучения.
    - Получает результаты экспериментов.
    - Сохраняет результаты в виде дашбордов.
    - Просматривает дашборды с результатами.

2. **Фронтенд**:
    - Предоставляет интерфейс для взаимодействия с пользователем.
    - Обрабатывает загруженные данные и отправляет запросы к бэкенду.
    - Отображает результаты и дашборды.

3. **Бэкенд**:
    - Обрабатывает загруженные данные, автоматически распознает форматы, удаляет выбросы, категоризирует колонки.
    - Запускает модели машинного обучения для анализа данных.
    - Сохраняет метаданные и результаты экспериментов в базе данных.
    - Предоставляет API для взаимодействия с фронтендом.

4. **Обработка данных**:
    - Реализует автоматические преобразования данных с использованием библиотек Pandas и NumPy.
    - Управляет преобразованиями данных (фича-стор).

5. **Модели машинного обучения**:
    - Интегрирует существующие модели Scikit-learn, TensorFlow, PyTorch.
    - Поддерживает загрузку и использование собственных моделей пользователей.

6. **Визуализация данных**:
    - Создает информативные графики и диаграммы с использованием Plotly, Matplotlib и D3.js.

7. **Хранение метаданных**:
    - Хранит метаданные и результаты экспериментов в базе данных PostgreSQL.

8. **Контейнеризация**:
    - Создает Docker-контейнеры для каждого сервиса.
    - Оркестрирует контейнеры с использованием Kubernetes.

9. **CI/CD**:
    - Настройка автоматических тестов для бэкенда и фронтенда.
    - Автоматическое развертывание приложения с использованием GitHub Actions или GitLab CI.


##  Этап 1. Подготовка данных

### Описание данных/сущностей:

P.S.: Важно понимать что данная платформа является инфраструктурным решением и в самом проекте ни каких данных нет и не будет.
На платформу приходят пользователи со своими данными - а потом эти данные на платформе можно анализировать.

- Проект GenomeCraft работает с генетическими данными, которые включают в себя различные типы данных, связанные с генами и геномами:
  - Геномные последовательности: ДНК-последовательности, содержащие информацию о структуре генов и хромосом.
  - Экспрессия генов: данные об уровне экспрессии генов в различных условиях или типах клеток.
  - Метаданные: информация о пробах, таких как тип ткани, условия эксперимента и клинические данные.
- Данные собираются из различных источников, включая базы данных генетических исследований, научные публикации и собственные эксперименты лабораторий.

### Объем и качество данных:
- Объем данных может быть значительным, особенно при работе с геномными последовательностями и данными экспрессии генов.
- Качество данных может варьироваться в зависимости от источника. Данные из публичных баз могут иметь разную степень обработки и чистоты. Собственные данные лабораторий могут быть более актуальными и точными, но их объем может быть ограничен.

### Процесс генерации данных:
- Данные генерируются в процессе научных исследований и экспериментов.
- Геномные последовательности могут быть получены с помощью методов секвенирования ДНК, таких как NGS (секвенирование нового поколения).
- Данные экспрессии генов могут быть получены с помощью методов, таких как микрочипы, секвенирование РНК или RT-PCR.
- Метаданные собираются и регистрируются вместе с экспериментальными данными.

### Конфиденциальность данных:
- Генетические данные могут содержать конфиденциальную информацию о пациентах или участниках исследований.
- Необходимо соблюдать строгие требования к защите данных, включая шифрование и разграничение доступа.
- Данные должны быть анонимизированы и обезличены, чтобы обеспечить конфиденциальность.

### EDA и проблемы с данными:
- Необходимо провести EDA (Exploratory Data Analysis) для выявления возможных проблем с данными, таких как выбросы, пропуски или несбалансированность классов.
- Особое внимание следует уделить обработке и нормализации данных, особенно при работе с геномными последовательностями и данными экспрессии генов.
- Важно учитывать возможные проблемы, связанные с интеграцией данных из разных источников, таких как несоответствие форматов или различная степень обработки.

### Необходимый результат этапа:
- Полностью подготовленный и очищенный датасет, готовый для использования в моделировании.
- Согласованная структура данных, включающая геномные последовательности, данные экспрессии генов и метаданные.
- Обеспечение конфиденциальности данных и соблюдение требований к защите информации.

##  Этап 2. Подготовка прогнозных моделей

### ML-метрики и функции потерь:
- Задача проекта GenomeCraft включает в себя различные задачи машинного обучения, такие как классификация, регрессия или кластеризация.
- Выбор метрик и функций потерь будет зависеть от конкретной задачи:
  - Классификация: точность, чувствительность, специфичность, F1-score.
  - Регрессия: MSE, RMSE, R², MAE.
  - Кластеризация: Silhouette score, Calinski-Harabasz index.
- Функции потерь могут включать в себя MSE, Cross-Entropy loss или другие, в зависимости от задачи.

### Схема ML-валидации:
- Валидация по времени: разделение данных на тренировочную и тестовую выборки по временному признаку для учета изменений в данных.
- Кросс-валидация: использование k-fold или leave-one-out кросс-валидации для оценки стабильности модели.
- Валидация по лабораториям: разделение данных по лабораториям для оценки способности модели обобщать на данные из разных источников.

### Бейзлайн и моделирование:
- Бейзлайн: использование базовых моделей, таких как линейная регрессия, логистическая регрессия или K-средних для задач регрессии, классификации и кластеризации соответственно.
- Предобработка данных:
  - Обработка пропусков: удаление пропусков.
  - Нормализация данных: масштабирование или стандартизация.
  - Разделение данных на тренировочную и тестовую выборки.
- Моделирование:
  - Выбор и настройка моделей машинного обучения: случайный лес, градиентный бустинг, нейронные сети.
  - Оптимизация гиперпараметров: использование методов, таких как Grid Search или Random Search.

### Стратегии развития:
- Интеграция дополнительных методов машинного обучения, таких как сверточные нейронные сети для анализа геномных последовательностей или рекуррентные нейронные сети для анализа временных рядов экспрессии генов.
- Исследование различных методов предобработки данных, таких как масштабирование, нормализация или преобразование данных.
- Использование методов отбора признаков для выявления наиболее важных фичей.
- Оптимизация гиперпараметров с использованием методов, таких как Bayesian Optimization или Genetic Algorithms.

### Анализ и интерпретация:
- Использование методов интерпретации моделей, таких как SHAP или LIME, для понимания вклада различных фичей в предсказания модели.
- Визуализация результатов кластеризации или классификации для анализа групп генов или образцов.

### Риски и их снижение:
- Плохая предсказательная способность модели:
  - Проведение тщательной валидации и тестирования модели.
  - Использование методов регуляризации для предотвращения переобучения.
  - Проверка гипотез на дополнительных датасетах.
- Проблемы с качеством данных:
  - Проведение EDA и очистки данных на регулярной основе.
  - Использование методов обнаружения выбросов и выбросов.
- Конфиденциальность данных:
  - Соблюдение строгих требований к защите данных.
  - Анонимизация и шифрование данных.

### Необходимый результат этапа:
- Разработка и настройка прогнозных моделей для решения конкретных задач, связанных с анализом генетических данных.
- Анализ и интерпретация результатов для понимания вклада различных фичей и моделей.
- Обеспечение конфиденциальности данных и соблюдение требований к защите информации.

## Дополнительные этапы:

- Этап 3. Интеграция с лабораториями:
  - Интеграция платформы с лабораторными системами для автоматической загрузки и обработки данных.
  - Разработка API для обмена данными между лабораториями и платформой.
  - Обеспечение безопасности и конфиденциальности данных при обмене.

- Этап 4. Визуализация и анализ результатов:
  - Разработка дашбордов и визуализаций для анализа результатов экспериментов.
  - Интеграция инструментов визуализации данных, таких как Plotly или Tableau.
  - Создание интерактивных графиков и диаграмм для анализа генетических данных.

- Этап 5. Совместная работа и коллаборация:
  - Разработка функций для совместной работы нескольких лабораторий над одним проектом.
  - Реализация систем контроля версий и управления доступом.
  - Обеспечение безопасности и конфиденциальности данных при совместной работе.

- Этап 6. Развертывание и CI/CD:
  - Настройка процесса непрерывной интеграции и развертывания (CI/CD) для автоматического тестирования и развертывания изменений.
  - Использование Docker и Kubernetes для контейнеризации и оркестрации микросервисов.
  - Настройка систем мониторинга и логирования для отслеживания работы платформы.